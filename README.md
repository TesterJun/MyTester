# MyTester自动化测试框架说明文档

### 介绍

- 基于Python语言开发, 以高扩展性/易维护性/易用性为重点来设计和实现的通用自动化测试框架.
- 支持构建数据驱动/关键字驱动/行为驱动的自动化测试.

### 设计

> ![测试框架架构图](https://images.gitee.com/uploads/images/2020/1107/174524_9a679ea4_8279610.jpeg "测试框架架构图.jpg")

### 术语定义

|名词|解释|
|-------|------------------------------------------------------------------------|
| 测试框架  | 由一个或多个自动化测试基础模块、自动化测试管理模块、自动化测试统计模块等组成的工具集合.|
| 测试关键字 | 在测试用例中以调用的形式来使用并提供操作参数执行一个或多个组合操作的方法. |
| 测试用例  | 自动化测试用例.|
| 测试套件  | 以目录形式进行管理的, 可完成一组测试内容的测试用例集合.|
| 测试对象  | 测试关键字操作的对象.|
| 测试变量  | 可在配置文件中预设的键值对; 在调用测试关键字时, 可使用键名来代替对应的值作为测试关键字的输入.|

### 安装

####  1. 安装环境

|配置项|版本|
|--|--|
|操作系统|Windows(7/10) / CentOS(7) / Mac|
|软件依赖|Python 3 任意版本|
|编辑器|不依赖编辑器, 推荐使用VS code或Pycharm(本文档中使用VS code)|

####  2. 解压

    下载zip后解压至任意路径.

####  3. 安装插件

    在MyTester/Ex目录下执行安装命令:  
```pip install case_keywords-1.0.tar.gz```

####  4. 目录说明

> ![目录结构](https://images.gitee.com/uploads/images/2020/1107/181443_67847217_8279610.jpeg "MyTester目录结构.jpg")

| 目录     | 说明          |
|--------|-------------|
| Case   | 测试套件/用例管理目录 |
| Config | 测试配置文件管理目录  |
| Ex     | 插件/工具存放目录   |
| Report | 测试报告/测试日志保存目录(运行时自动生成) |
| Manager.exe/Manager | 测试框架执行入口程序(.exe格式为Windows系统入口/可执行文档格式为Unix/Mac系统入口) |


####  5. 安装验证

    在MyTester目录下运行对应系统的执行入口, 若自动执行示例套件成功即安装成功, 如下图:
> ![输入图片说明](https://images.gitee.com/uploads/images/2020/1107/182602_5e50fea9_8279610.png "屏幕截图.png")

    按照提示完成交互可开始或停止执行测试.

### 使用说明

#### 1. 测试构建

##### 1.1 测试配置
> ![](https://images.gitee.com/uploads/images/2020/1107/195010_089aa3be_8279610.png "屏幕截图.png")

    在Config目录下使用ini格式文件配置测试执行所需的执行参数/测试变量/测试对象.  
    在文件中可使用"#"或";"符号注释所在行的内容.
    
 1.1.1 配置执行参数
> ![输入图片说明](https://images.gitee.com/uploads/images/2020/1107/210611_a4721cf4_8279610.png "屏幕截图.png")

-  **配置方法** 

        执行参数在config标签下指定.

-  **参数说明**   

    |配置项|可选参数|说明|
    |-----|-----|-----|
    |case|-|设置运行时使用的测试套件目录名|
    |mode|test|设置运行模式为执行全部模式|
    ||test_somke|设置运行模式为执行特殊用例模式|
    ||test_fail|设置运行模式为执行回归模式|

-  **模式说明** 

        mode指定为test时:  
            在Case/case_test目录下查找指定的测试套件;  
            执行测试套件包含的所有测试用例;  
            失败用例备份至Case/case_fail目录.  
        
        mode指定为test_somke时:  
            在Case/case_test目录下查找指定的测试套件;  
            执行测试套件包含的特殊测试用例;  
            失败用例备份至Case/case_fail目录.  
        
        mode指定为test_fail时:  
            在Case/fail_test目录下查找指定的测试套件;  
            执行测试套件包含的所有测试用例;  
            失败用例保留, 通过则删除备份测试用例.  
    
1.1.2 配置测试变量
> ![输入图片说明](https://images.gitee.com/uploads/images/2020/1107/210645_a81601a7_8279610.png "屏幕截图.png")

-  **配置方法** 

        测试变量在global标签下指定, 不限数量, 等于号左侧为键名, 右侧为数据.

-  **配置规则**   

        键名不可重复, 数据可重复或为空.

-  **使用范围**

        测试变量只在编写测试用例时作为测试关键字参数输入时有效, 其他输入和交互不会生效. 

1.1.3 配置测试对象  
> ![输入图片说明](https://images.gitee.com/uploads/images/2020/1107/210929_5160779e_8279610.png "屏幕截图.png")

-  **配置方法**   

        测试对象使用自定义标签指定对象名称;
        可配置多个测试对象;
        对象名称不可重复或使用config/global.
    
-  **对象属性**   

        对象名下配置测试对象属性;
        图中配置为示例形式, 实际使用需根据测试对象使用的测试关键字生成规则来进行配置(参考测试关键字对应的说明文档);
_**备注** : 执行实例测试套件或使用内置关键字编写用例时不需配置测试对象_

##### 1.2 编写测试用例

1.2.1 套件管理目录
> ![输入图片说明](https://images.gitee.com/uploads/images/2020/1107/212243_98964fb3_8279610.png "屏幕截图.png")

    测试用例相关的操作统一在Case目录下进行;
    Case目录包含两个子目录及一个测试用例示例文件; 
    case_test目录为测试套件管理目录;
    case_fail为测试套件/用例备份目录(运行测试后自动生成).

1.2.2 测试套件
> ![输入图片说明](https://images.gitee.com/uploads/images/2020/1107/212422_10530389_8279610.png "屏幕截图.png")

    在测试执行时对应的管理目录下必须存在配置文件中指定的测试套件;
    以文档中的配置文件为例, 在Case/case_test目录下应当存在Project_exm测试套件.

-  **用例管理方法**  

        测试套件中可使用子目录管理测试用例, 子目录不限层级深度.

-  **命名规则**  

        测试套件及子目录都可以使用中文命名; 
        建议使用编号排序, 便于管理和执行.

1.2.3 测试用例
> ![输入图片说明](https://images.gitee.com/uploads/images/2020/1107/212709_99717b87_8279610.png "屏幕截图.png")

    用例按照命名规则分类, 可包含中文, 规则如下:
        命名中包含”_test_”的用例文件将识别为常规测试用例;
        命名中包含”__test__”的用例文件将识别为特殊测试用例;
        命名以”test_setup”开头的文件将识别为目录前置用例;
        命名以”test_teardown”开头的用例文件将识别为目录后置用例;
        命名以”case_setup”开头的文件将识别为公共前置用例;
        命名以”case_teardown”开头的用例文件将识别为公共后置用例;
        未命中以上规则的文件或非py文件将识别为非用例文件.
        
        用例类型与用例执行顺序关联, 规则详见2.3 - 测试套件执行流程.
    
-  **用例构成**  
> ![输入图片说明](https://images.gitee.com/uploads/images/2020/1107/213002_19223c1b_8279610.png "屏幕截图.png")

     常规测试用例/特殊测试用例通常分为用例头部/前置步骤/测试步骤/后置步骤四部分;  
     目录前置/后置用及公共前置/后置用例通常分为用例头部/步骤两部分;  
     用例头部通常为导入测试关键字库(第1行)及自定义关键字库名称(第3行)语句;  
     前置步骤需使用setup方法声明(第4行);  
     测试步骤需使用step方法声明(第9行);  
     后置步骤需使用teardown方法声明(第19行);  
     在步骤声明后编写的测试关键字属于对应的部分, 步骤类型与步骤执行顺序/断言逻辑关联, 规则详见2.3 - 测试用例执行流程.

-  **注释方法**  

        使用符号#开头的内容将识别为注释行, 执行时会跳过注释的步骤, 必要时应当使用注释行说明用例内容.

##### 1.3 开始编写

1.3.1 起始用例
> ![输入图片说明](https://images.gitee.com/uploads/images/2020/1107/213343_1f9b68ab_8279610.png "屏幕截图.png")

        Case目录下包含一个case_example.py文件, 此文件为导入公共关键字及定义了前置步骤/测试步骤/后置步骤的初始用例;
        可将起始用例复制到测试套件后, 在此基础上进行用例编写.

1.3.2 编写用例

-  **编写方法**  

       用例中前置/步骤/后置部分包含的所有执行步骤都应当使用测试关键字编写;

-  **编写规范**  
> ![输入图片说明](https://images.gitee.com/uploads/images/2020/1107/213849_05d3185c_8279610.png "屏幕截图.png")

        测试关键字编写时可抽象为三部分: 方法/对象/参数, 即什么操作 - 操作谁 - 怎么操作;
        为保证测试用例的复用性和可维护性, 应适当使用测试变量作为操作参数.

-  **编写参考**  

       在实际使用中编写用例时通常会使用自定义的扩展测试关键字库,
       应当提供对应的API文档来说明测试关键字的对象定义方法及使用方法.
       文档格式可参考框架内置的测试关键字文档(见wiki - Keywords Exp/Public Keywrods).
 
#### 2.  测试执行

##### 2.1 执行方法

    完成配置文件和测试套件/用例后, 运行系统对应的入口程序Manager来执行测试; 
    windows系统下可以双击运行, 也可以在命令行中运行; 
    在命令行中运行时可以使用运行参数, 参数可不按顺序输入.

##### 2.2 执行参数
> ![输入图片说明](https://images.gitee.com/uploads/images/2020/1107/215658_bce4660f_8279610.png "屏幕截图.png")

|参数|可选输入|说明|
|-|-|-|
|config|Config文件名|可指定执行测试时使用的配置文件, 支持模糊匹配 不使用参数运行时, 默认配置文件为Config_info.ini|
|case|套件子目录或用例路径|可指定执行测试时运行测试用例的范围, 输入某个目录路径则运行该目录下的所有测试用例; 输入某个测试用例路径则运行该用例|
|log|no_log|指定日志等级为NO_LOG, 运行时不会生成运行日志|
||run_log|默认日志等级, 运行时打印并记录运行日志|
||info|指定日志等级为INFO, 运行时打印INFO级别信息|
||debug|指定日志等级为DEBUG, 运行时打印DEBUG级别信息|
|run_time| - |指定测试套件执行的次数, 默认为1次|

_**备注**: 日志等级由no_log到debug为从低到高; 指定等级时, 比指定等级低的日志功能同时生效._

##### 2.3 执行流程

-  **测试套件执行流程**
>![输入图片说明](https://images.gitee.com/uploads/images/2020/1107/220041_9e01aa26_8279610.png "屏幕截图.png")

-  **测试用例执行流程**
>![输入图片说明](https://images.gitee.com/uploads/images/2020/1107/220014_0bf2094f_8279610.png "屏幕截图.png")

#### 3.  测试输出

##### 3.2 测试报告

> ![输入图片说明](https://images.gitee.com/uploads/images/2020/1108/175206_0de26002_8279610.png "屏幕截图.png")

    测试执行完成时打印本次测试所生成报告的路径.

> ![输入图片说明](https://images.gitee.com/uploads/images/2020/1108/181043_e38c582d_8279610.png "屏幕截图.png")

    可使用浏览器打开查看报告内容.

-  **执行信息**
> ![输入图片说明](https://images.gitee.com/uploads/images/2020/1108/175618_2b1aaba7_8279610.png "屏幕截图.png")

-  **用例执行状态**
> ![输入图片说明](https://images.gitee.com/uploads/images/2020/1108/181112_33e6a44a_8279610.png "屏幕截图.png")

    测试用例执行结果分为以下类型:
        PASS - 通过(绿色)
        EFAIL - 预期失败(绿色)
        FAIL - 失败(红色)
        ERROR - 步骤错误(黄色)
        CASE ERROR - 用例错误(黄色)
        NO_RUN - 未执行(灰色)

-  **步骤执行状态** 
> ![输入图片说明](https://images.gitee.com/uploads/images/2020/1108/181147_12412383_8279610.png "屏幕截图.png")

    步骤执行结果分为以下类型:
        PASS - 通过(绿色)
        FAIL - 失败(红色)
        ERROR - 步骤错误(红色)
        NO_RUN - 未执行(灰色)

-  **步骤执行信息**
> ![输入图片说明](https://images.gitee.com/uploads/images/2020/1108/181215_d73c016e_8279610.png "屏幕截图.png")

##### 3.2 执行日志
> ![输入图片说明](https://images.gitee.com/uploads/images/2020/1108/181244_d8e417fd_8279610.png "屏幕截图.png")

    报告的执行信息部分显示本次测试执行的运行日志保存路径.

> ![输入图片说明](https://images.gitee.com/uploads/images/2020/1108/181333_a4dc524c_8279610.png "屏幕截图.png")

    日志内容与run_log输出内容相同.

##### 3.2 失败用例

    执行测试时(非test_fail模式下)会在Case/case_fail目录下生成相同目录结构的测试套件.
> ![输入图片说明](https://images.gitee.com/uploads/images/2020/1108/181353_d27e1057_8279610.png "屏幕截图.png")

    执行测试时(非test_fail模式下)会在Case/case_fail目录下生成相同目录结构的测试套件.
> ![输入图片说明](https://images.gitee.com/uploads/images/2020/1108/181433_3649f5ee_8279610.png "屏幕截图.png")

    套件中执行失败的测试用例将备份至此套件目录的相同位置.